services:
  genesis:
    image: oiz-genesis
    env_file: .env
    environment:
      NUMS_OF_VALIDATOR: 1
    volumes:
      - ./storage:/root/storage
      - ./scripts:/root/scripts
      - ./config:/root/config
      - ./init-holders:/root/init-holders
    command: /root/scripts/bootstrap.sh
  
  oiz-rpc:
    image: oiz
    healthcheck:
      test: nc -z localhost 8545
      interval: 3s
      timeout: 5s
      retries: 15
    env_file: .env
    environment:
      NODE_ID: oiz-rpc
    volumes:
      - ./storage/oiz-rpc:/root/.ethereum
      - ./scripts:/scripts
      - ./config:/config
    entrypoint: [ "sh", "-c", "/scripts/oiz-rpc.sh" ]
    networks:
      default:
        ipv4_address: 99.1.0.3

  oiz-validator1:
    image: oiz
    env_file: .env
    environment:
      NODE_ID: oiz-validator1
      BOOTSTRAP_HOST: oiz-rpc
    volumes:
      - ./storage/oiz-validator1:/root/.ethereum
      - ./scripts:/scripts
    entrypoint: [ "sh", "-c", "/scripts/oiz-validator.sh" ]
    networks:
      default:
        ipv4_address: 99.1.0.2
  
  truffle-test:
    image: truffle-test
    command: /scripts/truffle-test.sh
    env_file: .env
    environment:
      RPC_HOST: oiz-rpc
      RPC_PORT: 8545
    volumes:
      - ./scripts:/scripts
    depends_on:
      oiz-rpc:
        condition: service_healthy

networks:
  default:
    ipam:
      driver: default
      config:
        - subnet: 99.1.0.0/16
